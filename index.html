<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Medical Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: var(--tg-theme-bg-color, #ffffff);
      --text: var(--tg-theme-text-color, #000000);
      --card-bg: rgba(255, 255, 255, 0.8);
      --btn-bg: var(--tg-theme-button-color, #0088cc);
      --btn-text: var(--tg-theme-button-text-color, #ffffff);
    }

    body {
      font-family: sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: auto;
    }

    h2, h3 {
      text-align: center;
    }

    .grid {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      margin-bottom: 20px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }

    .card:hover {
      transform: scale(1.03);
    }

    #question-section {
      display: none;
    }

    #choices button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid #ccc;
      background-color: #eee;
      color: #000;
    }

    #choices button.correct {
      background-color: #d4f5d4;
      border-color: green;
    }

    #choices button.incorrect {
      background-color: #f5d4d4;
      border-color: red;
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
    }

    .nav-buttons button {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background-color: var(--btn-bg);
      color: var(--btn-text);
      font-weight: bold;
    }

    #progress-bar {
      height: 10px;
      width: 100%;
      background: #ddd;
      margin-bottom: 15px;
      border-radius: 5px;
      overflow: hidden;
    }

    #progress-inner {
      height: 100%;
      background: #4caf50;
      width: 0%;
      transition: width 0.3s;
    }

    .hidden { display: none; }

    .back-button {
      margin-bottom: 15px;
      background-color: #ccc;
      border: none;
      padding: 10px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Medical Quiz</h2>

    <div id="system-view" class="grid"></div>

    <div id="subject-view" class="hidden">
      <button class="back-button" onclick="backToSystems()">‚Üê Back</button>
      <div class="grid" id="subject-grid"></div>
    </div>

    <div id="chapter-view" class="hidden">
      <button class="back-button" onclick="backToSubjects()">‚Üê Back</button>
      <div class="grid" id="chapter-grid"></div>
    </div>

    <div id="question-section" class="hidden">
      <button class="back-button" onclick="backToChapters()">‚Üê Back</button>
      <div id="progress-bar"><div id="progress-inner"></div></div>
      <h3 id="question-text"></h3>
      <div id="choices"></div>
      <div class="nav-buttons">
        <button onclick="prevQuestion()">Previous</button>
        <button onclick="nextQuestion()">Next</button>
      </div>
      <div style="margin-top: 10px; text-align: center;">
        <button onclick="restartQuiz()" style="padding: 10px 20px; background: #f0f0f0; border: none; border-radius: 8px; font-weight: bold;">üîÅ Restart Quiz</button>
      </div>
    </div>
  </div>

  <script>
    const data = {
      "Musculoskeletal": {
        "Anatomy": {
          "Upper Limb": [
            {
              question: "Which nerve innervates the deltoid muscle?",
              choices: ["Radial", "Ulnar", "Axillary", "Median"],
              correct: 2
            },
            {
              question: "What type of joint is the shoulder?",
              choices: ["Hinge", "Ball and Socket", "Pivot", "Saddle"],
              correct: 1
            }
          ]
        },
        "Physiology": {
          "Muscle Contraction": [
            {
              question: "What ion is essential for muscle contraction?",
              choices: ["Sodium", "Potassium", "Calcium", "Magnesium"],
              correct: 2
            },
            {
              question: "What is the contractile unit of a muscle?",
              choices: ["Myofibril", "Actin", "Sarcomere", "Myosin"],
              correct: 2
            }
          ]
        }
      },
      "Cardiopulmonary": {
        "Physiology": {
          "Heart": [
            {
              question: "What is the pacemaker of the heart?",
              choices: ["AV Node", "SA Node", "Bundle of His", "Purkinje fibers"],
              correct: 1
            },
            {
              question: "Which valve is between left atrium and ventricle?",
              choices: ["Tricuspid", "Mitral", "Aortic", "Pulmonary"],
              correct: 1
            }
          ]
        }
      },
      "Gastrointestinal": {
        "Histology": {
          "Small Intestine": [
            {
              question: "What increases surface area in the small intestine?",
              choices: ["Villi", "Crypts", "Cilia", "Rugae"],
              correct: 0
            },
            {
              question: "Which cells secrete mucus?",
              choices: ["Goblet", "Paneth", "Chief", "Enterocytes"],
              correct: 0
            }
          ]
        }
      }
    };

    let currentSystem, currentSubject, currentChapter;
    let questions = [], currentIndex = 0;

    const systemView = document.getElementById("system-view");
    const subjectView = document.getElementById("subject-view");
    const subjectGrid = document.getElementById("subject-grid");
    const chapterView = document.getElementById("chapter-view");
    const chapterGrid = document.getElementById("chapter-grid");
    const questionSection = document.getElementById("question-section");
    const questionText = document.getElementById("question-text");
    const choicesDiv = document.getElementById("choices");

    function showSystems() {
      systemView.innerHTML = "";
      for (let sys in data) {
        const card = createCard(sys, () => showSubjects(sys));
        systemView.appendChild(card);
      }
    }

    function showSubjects(system) {
      currentSystem = system;
      systemView.classList.add("hidden");
      subjectView.classList.remove("hidden");
      subjectGrid.innerHTML = "";
      for (let subj in data[system]) {
        const card = createCard(subj, () => showChapters(system, subj));
        subjectGrid.appendChild(card);
      }
    }

    function showChapters(system, subject) {
      currentSubject = subject;
      subjectView.classList.add("hidden");
      chapterView.classList.remove("hidden");
      chapterGrid.innerHTML = "";
      for (let chap in data[system][subject]) {
        const card = createCard(chap, () => startQuiz(system, subject, chap));
        chapterGrid.appendChild(card);
      }
    }

    function createCard(title, onClick) {
      const div = document.createElement("div");
      div.className = "card";
      div.textContent = title;
      div.onclick = onClick;
      return div;
    }

    function startQuiz(system, subject, chapter) {
      currentChapter = chapter;
      chapterView.classList.add("hidden");
      questionSection.classList.remove("hidden");
      questions = data[system][subject][chapter];
      currentIndex = 0;
      showQuestion();
    }

    function showQuestion() {
      const q = questions[currentIndex];
      questionText.textContent = q.question;
      choicesDiv.innerHTML = "";

      q.choices.forEach((choice, idx) => {
        const btn = document.createElement("button");
        btn.textContent = choice;
        btn.onclick = () => {
          disableAllButtons();
          if (idx === q.correct) {
            btn.classList.add("correct");
          } else {
            btn.classList.add("incorrect");
            choicesDiv.children[q.correct].classList.add("correct");
          }
        };
        choicesDiv.appendChild(btn);
      });

      updateProgress();
    }

    function disableAllButtons() {
      document.querySelectorAll("#choices button").forEach(btn => btn.disabled = true);
    }

    function nextQuestion() {
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        showQuestion();
      }
    }

    function prevQuestion() {
      if (currentIndex > 0) {
        currentIndex--;
        showQuestion();
      }
    }

    function restartQuiz() {
      currentIndex = 0;
      showQuestion();
    }

    function updateProgress() {
      const percent = ((currentIndex + 1) / questions.length) * 100;
      document.getElementById("progress-inner").style.width = percent + "%";
    }

    function applyTelegramTheme() {
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.ready();
        document.body.style.backgroundColor = Telegram.WebApp.themeParams.bg_color || "#fff";
        document.body.style.color = Telegram.WebApp.themeParams.text_color || "#000";
      }
    }

    function backToSystems() {
      subjectView.classList.add("hidden");
      systemView.classList.remove("hidden");
    }

    function backToSubjects() {
      chapterView.classList.add("hidden");
      subjectView.classList.remove("hidden");
    }

    function backToChapters() {
      questionSection.classList.add("hidden");
      chapterView.classList.remove("hidden");
    }

    window.onload = () => {
      applyTelegramTheme();
      showSystems();
    };
  </script>
</body>
</html>
